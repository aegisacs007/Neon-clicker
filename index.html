<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Empire: Balanced</title>
    <style>
        body {
            background-color: #050505; color: white;
            font-family: 'Segoe UI', sans-serif; text-align: center;
            display: flex; flex-direction: column; align-items: center;
            height: 100vh; margin: 0; overflow: hidden; touch-action: manipulation;
        }

        /* TOP BAR */
        .header {
            width: 100%; padding: 15px; display: flex; justify-content: space-between; align-items: center;
            background: rgba(255, 255, 255, 0.05); box-sizing: border-box;
        }
        .mute-btn { cursor: pointer; font-size: 20px; background: none; border: none; }

        /* SCORE */
        .currency { color: #00ffcc; text-shadow: 0 0 15px #00ffcc; font-size: 40px; font-weight: 800; margin-top: 20px; }
        .cps-display { color: #888; font-size: 12px; margin-bottom: 20px; letter-spacing: 1px; }

        /* CLICK BUTTON */
        #click-area { flex-grow: 1; display: flex; align-items: center; justify-content: center; width: 100%; }
        #click-btn {
            width: 160px; height: 160px;
            background: radial-gradient(circle at 30% 30%, #2a2a2a, #000);
            border-radius: 50%; border: 4px solid #333;
            box-shadow: 0 0 30px rgba(0, 255, 204, 0.1);
            display: flex; align-items: center; justify-content: center;
            font-size: 60px; cursor: pointer; transition: transform 0.05s;
            -webkit-tap-highlight-color: transparent; user-select: none;
        }
        #click-btn:active { transform: scale(0.94); border-color: #00ffcc; }

        /* SHOP */
        .shop { 
            width: 100%; background: #111; padding: 20px; 
            border-radius: 25px 25px 0 0; box-sizing: border-box; 
            height: 45%; overflow-y: auto; border-top: 1px solid #333;
        }
        .item {
            display: flex; justify-content: space-between; align-items: center;
            background: #1a1a1a; padding: 12px; border-radius: 12px; margin-bottom: 8px;
            border: 1px solid #333; transition: 0.2s; cursor: pointer;
        }
        .item:active { background: #222; }
        .item-info { text-align: left; }
        .item-name { font-weight: bold; font-size: 14px; }
        .item-cost { color: #ffd700; font-size: 13px; }
        .item-count { background: #333; padding: 2px 8px; border-radius: 10px; font-size: 10px; color: #ccc; }

        .particle { position: absolute; pointer-events: none; background: #00ffcc; width: 5px; height: 5px; animation: pop 0.8s forwards; }
        @keyframes pop { 100% { transform: translate(var(--x), var(--y)); opacity: 0; } }
    </style>
</head>
<body>

    <div class="header">
        <span style="font-size:12px; color:#666;">v5.0 (Reddit Fix)</span>
        <button class="mute-btn" onclick="toggleMute()" id="muteIcon">ðŸ”Š</button>
    </div>

    <div class="currency">$<span id="score">0</span></div>
    <div class="cps-display"><span id="cps">0</span> / sec</div>

    <div id="click-area">
        <div id="click-btn" onclick="handleClick(event)">ðŸ’Ž</div>
    </div>

    <div class="shop" id="shop-container">
        </div>

    <script>
        // --- CONFIGURATION ---
        let game = {
            score: 0,
            soundOn: true,
            items: [
                { id: 0, name: "Cursor Upgrade", baseCost: 15, count: 0, rate: 0, clickPower: 1 },
                { id: 1, name: "Auto-Bot", baseCost: 100, count: 0, rate: 5, clickPower: 0 },
                { id: 2, name: "Crypto Farm", baseCost: 1100, count: 0, rate: 30, clickPower: 0 },
                { id: 3, name: "AI Server", baseCost: 12000, count: 0, rate: 150, clickPower: 0 }
            ]
        };

        // Load Save
        if(localStorage.getItem('neonSaveV5')) {
            game = JSON.parse(localStorage.getItem('neonSaveV5'));
        }

        // --- AUDIO ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playTone(freq) {
            if(!game.soundOn) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.frequency.value = freq;
            osc.type = 'triangle';
            gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.1);
        }

        function toggleMute() {
            game.soundOn = !game.soundOn;
            document.getElementById('muteIcon').innerText = game.soundOn ? "ðŸ”Š" : "ðŸ”‡";
            saveGame();
        }

        // --- CORE LOGIC ---
        function getCost(item) {
            // MATH FIX: Cost increases by 15% for every item bought
            return Math.floor(item.baseCost * Math.pow(1.15, item.count));
        }

        function getCPS() {
            return game.items.reduce((acc, item) => acc + (item.rate * item.count), 0);
        }
        
        function getClickPower() {
            return 1 + game.items[0].count; // Cursor upgrades click power
        }

        function handleClick(e) {
            game.score += getClickPower();
            playTone(600 + (Math.random()*200));
            spawnParticles(e);
            updateUI();
        }

        function buy(id) {
            let item = game.items[id];
            let cost = getCost(item);
            if(game.score >= cost) {
                game.score -= cost;
                item.count++;
                playTone(300);
                updateUI();
                saveGame();
            }
        }

        // --- UI & LOOP ---
        function updateUI() {
            document.getElementById('score').innerText = Math.floor(game.score).toLocaleString();
            document.getElementById('cps').innerText = getCPS();
            document.getElementById('muteIcon').innerText = game.soundOn ? "ðŸ”Š" : "ðŸ”‡";

            const shopDiv = document.getElementById('shop-container');
            shopDiv.innerHTML = "";
            
            game.items.forEach(item => {
                let cost = getCost(item);
                let desc = item.clickPower > 0 ? `+${item.clickPower} Click` : `+${item.rate}/sec`;
                let color = game.score >= cost ? "#fff" : "#555";
                
                shopDiv.innerHTML += `
                <div class="item" onclick="buy(${item.id})" style="border-color:${color}">
                    <div class="item-info">
                        <div class="item-name">${item.name} <span class="item-count">${item.count}</span></div>
                        <div class="item-cost" style="color:${game.score >= cost ? '#ffd700' : '#777'}">$${cost.toLocaleString()}</div>
                    </div>
                    <div style="font-size:12px; color:#888;">${desc}</div>
                </div>`;
            });
        }

        function spawnParticles(e) {
            for(let i=0; i<3; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.style.setProperty('--x', (Math.random()-0.5)*100+'px');
                p.style.setProperty('--y', (Math.random()-0.5)*100+'px');
                p.style.left = e.clientX + 'px';
                p.style.top = e.clientY + 'px';
                document.body.appendChild(p);
                setTimeout(()=>p.remove(), 800);
            }
        }

        // Loop
        setInterval(() => {
            game.score += getCPS() / 10; // Run 10 times a second for smoothness
            updateUI();
            if(Math.random() < 0.1) saveGame(); // Save occasionally
        }, 100);

        function saveGame() {
            localStorage.setItem('neonSaveV5', JSON.stringify(game));
        }

        updateUI();
    </script>
</body>
</html>
